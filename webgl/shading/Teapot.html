<!DOCTYPE html>
<html lang="en">
<head>
<title>teapot shading by king_yin3613 </title>
<meta charset="UTF-8">
</head>

<script type="x-shader/x-vertex" id="vshaderSB">
     uniform mat4 projection;
     uniform mat4 modelview;
     attribute vec3 coords;
     varying vec3 vCoords;
     void main() {
        vec4 eyeCoords = modelview * vec4(coords,1.0);
        gl_Position = projection * eyeCoords;
        vCoords = coords;
     }
</script>

<script type="x-shader/x-fragment" id="fshaderSB">
     precision mediump float;
     varying vec3 vCoords;
     uniform samplerCube skybox;
     void main() {
        gl_FragColor = textureCube(skybox, vCoords);
     }
</script>

<script type="x-shader/x-vertex" id="vshader">
     uniform mat4 projection;
     uniform mat4 modelview;
     attribute vec3 coords;
     attribute vec3 normal;
     attribute vec3 texturecoords;

     varying vec3 viewCoords;
     varying vec3 vNormal;
     varying vec2 vTextureCoords;
     void main() {
        vec4 eyeCoords = modelview * vec4(coords,1.0);
        gl_Position = projection * eyeCoords;
        vTextureCoords = texturecoords.xy;
        viewCoords = eyeCoords.xyz;
        vNormal = normal;
     }
</script>

<script type="x-shader/x-fragment" id="fshader-simple">
     precision mediump float;
     varying vec3 vCoords;
     varying vec3 vNormal;
     varying vec2 vTextureCoords;
     varying vec3 viewCoords;
     
     uniform vec3 uLightPosition;
    
     uniform vec3 uAmbientLightColor;
     uniform vec3 uDiffuseLightColor;
     uniform vec3 uSpecularLightColor;

     uniform vec3 uAmbientMaterialColor;
     uniform vec3 uSpecularMaterialColor;
     uniform vec3 uDiffuseMaterialColor;
    
     uniform float uShininess;

     uniform mat3 normalMatrix;
     uniform mat3 invVT;
     void main() {
    
     // Calculate the vector (l) to the light source
     vec3 vectorToLightSource = normalize(uLightPosition - viewCoords);

     // Transform the normal (n) to eye coordinates
     vec3 normalEye = normalize(normalMatrix * vNormal);

     
     // The camera in eye coordinates is located in the origin and is pointing
     // along the negative z-axis. Calculate viewVector (v) 
     // in eye coordinates as:
     // (0.0, 0.0, 0.0) - vertexPositionEye3
     vec3 viewVectorEye = -normalize(viewCoords);

     // Calculate n dot l for diffuse lighting （a.k.a. "Lambert's cosine law"）
     float diffuseLightWeightning = max(dot(normalEye, 
                                    vectorToLightSource), 0.0);

     // ==================== Blinn-Phong Illumination Model ==================                                   
     // Calculate the halfway vector (h) of vector (l) to the light source and viewVector (v)
     vec3 halfwayVector = normalize(viewVectorEye + vectorToLightSource);

     // Compute the specular term 
     // Replace pow(rdotv, uShininess) by pow(hdotn, modified_uShininess)
     float hdotn = max(dot(halfwayVector,normalEye), 0.0);
     float specularLightWeightning = pow(hdotn, uShininess * 4.0);
     
     // Sum up all three reflection components and send to the fragment shader
     gl_FragColor = vec4(((uAmbientLightColor*uAmbientMaterialColor)
                + (uDiffuseLightColor*uDiffuseMaterialColor) * diffuseLightWeightning
                + (uSpecularLightColor*uSpecularMaterialColor) * specularLightWeightning),1.0);
     }
</script>

<script type="x-shader/x-fragment" id="fshader-reflective">
     precision mediump float;
     varying vec3 vCoords;
     varying vec3 vNormal;
     varying vec3 viewCoords;
     uniform samplerCube skybox;
     uniform mat3 normalMatrix;
     uniform mat3 invVT;
     
     void main() {
          vec3 N = normalMatrix * vNormal;
          vec3 V = -viewCoords;
          vec3 R = 2.0 * dot(V,N) * N - V;
          R = invVT * R; // Transform by inverse of view transform, which was applied to the skybox
          gl_FragColor = textureCube(skybox, R);
     }
</script>

<script type="text/javascript" src="jquery-2.1.0.min.js"></script>
<script type="text/javascript" src="webgl-utils.js"></script>
<script type="text/javascript" src="gl-matrix-min.js"></script>
<script type="text/javascript" src="simple-rotator.js"></script>
<script type="text/javascript" src="Teapot.js"></script>

<body onload="startup();" scroll="no">
    <h3 class="title" style="font-size: 1.6em; margin: 5px auto; line-height: 1.2em; font-family: Arial, Helvetica, sans-serif; background-color: rgb(255, 255, 255);">WebGL: Environment Mapping
    </h3>
    
    <canvas width=600 height=600 id="glcanvas" style="background-color:white"></canvas>

	<form style="font-family: Arial, Helvetica, sans-serif; font-size: 13.44px; margin: 5px auto; line-height: 20.16px; background-color: rgb(255, 255, 255);">
    Please select which shading method to use:
    
    <div>
    <input type="radio" onclick="changeShader('simple')" id="radio_id"
     name="shader" value="simple">
    <label for="simple">Blinn-Phong Shading (simple)</label>

    <input type="radio" onclick="changeShader('reflective')" id="radio_id"
     name="shader" value="reflective" checked>
    <label for="reflective">Environment Mapping (reflective)</label>
    </div>

    </form>

    <div class="content-middle" style="font-family: Arial, Helvetica, sans-serif; font-size: 13.44px; line-height: 20.16px; background-color: rgb(255, 255, 255);">
    <div class="node" style="margin: 0px 0px 0px; padding-bottom: 0px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: rgb(187, 187, 187); clear: both;">
    <div class="content" style="margin: 0px 0px;">
    <p>Instruction: </p>
    <ul>
    <li>Choose a shading method by clicking the radio button.</li>
    <li>Drag your mouse on the canvas to rotate the view. Use arrow keys to rotate the teapot only. </li>
    </ul>
    </div>
    </div>
    </div>

</body>
</html>

